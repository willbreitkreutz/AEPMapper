{"ast":null,"code":"import orderBy from \"lodash/orderBy\";\nimport layerConfig from \"./config.json\";\nimport scaleToZoomLevel from \"../cm2/scale-to-zoom-level\";\n\nfunction mapCm2ToCm3(layers) {\n  return layers.map(lyr => {\n    return {\n      id: lyr.NAME,\n      parentId: lyr.PARENT === \"root\" ? null : lyr.PARENT,\n      layerOrder: lyr.LAYERORDER,\n      serviceType: lyr.LAYERTYPE === \"F\" ? \"Folder\" : lyr.LAYERTYPE,\n      tiled: 0,\n      displayName: lyr.FULLNAME,\n      description: lyr.DESCRIPTION,\n      url: lyr.URL,\n      layerList: lyr.PARAMS ? lyr.PARAMS.layers ? lyr.PARAMS.layers : null : null,\n      attribution: null,\n      geometryType: null,\n      minzoom: scaleToZoomLevel(lyr.MINZOOM, 0),\n      maxzoom: scaleToZoomLevel(lyr.MAXZOOM, 20),\n      localTable: \"NOAA.NATIONAL_FCST_VW_MIN\",\n      metadataUrl: lyr.METADATA_URL,\n      minX: -180,\n      maxX: 180,\n      minY: -89,\n      maxY: 89,\n      opacity: lyr.OPTIONS ? lyr.OPTIONS.opacity ? lyr.OPTIONS.opacity : 1 : 1,\n      queryTemplate: null,\n      hoverTemplate: null,\n      queryable: 1,\n      visible: 0,\n      collapsed: 1,\n      idCol: \"objectid\",\n      shapeCol: \"SHAPE\",\n      allowEdit: 0,\n      allowExport: 1,\n      cacheTiles: 0,\n      labelDefault: 0,\n      labelEnabled: 0\n    };\n  });\n}\n\nexport default {\n  name: \"cm2\",\n  getReducer: () => {\n    const initialData = {\n      _shouldInitialize: false\n    };\n    return (state = initialData, {\n      type,\n      payload\n    }) => {\n      switch (type) {\n        case \"CM2_INITIALIZE_START\":\n        case \"CM2_INITIALIZE_FINISHED\":\n          return Object.assign({}, state, payload);\n\n        case \"MAP_INITIALIZED\":\n          return Object.assign({}, state, {\n            _shouldInitialize: true\n          });\n\n        default:\n          return state;\n      }\n    };\n  },\n  doCm2Initialize: () => ({\n    dispatch,\n    store\n  }) => {\n    dispatch({\n      type: \"CM2_INITIALIZE_START\",\n      payload: {\n        _shouldInitialize: false\n      }\n    }); // maybe turn this on at some point\n    // const params = store.selectWindowLocationParams();\n    // const turnOn = !params.layers ? [] : params.layers.split(\",\").map(Number);\n\n    const cm3Layers = mapCm2ToCm3(layerConfig);\n    const sortedLayers = orderBy(cm3Layers, [\"parentId\", \"layerOrder\"], [\"desc\", \"asc\"]);\n    sortedLayers.forEach(lyr => {\n      if (lyr.parentId) {\n        const idMap = store.selectIdMap();\n        lyr.parentUid = idMap[lyr.parentId];\n      } else {\n        lyr.parentUid = store.selectTreeViewRootId;\n      } // if (lyr.teamDatasetId && turnOn.indexOf(lyr.teamDatasetId) !== -1) {\n      //   lyr.visible = true;\n      // }\n\n\n      store.doAddLayer(lyr);\n    });\n    dispatch({\n      type: \"CM2_INITIALIZE_FINISHED\"\n    });\n  },\n  reactCm2ShouldInitialize: state => {\n    if (state.cm2._shouldInitialize) return {\n      actionCreator: \"doCm2Initialize\"\n    };\n  }\n};","map":{"version":3,"sources":["C:\\Examples\\aepmapper\\src\\plugins\\cm2-layers\\bundle.js"],"names":["orderBy","layerConfig","scaleToZoomLevel","mapCm2ToCm3","layers","map","lyr","id","NAME","parentId","PARENT","layerOrder","LAYERORDER","serviceType","LAYERTYPE","tiled","displayName","FULLNAME","description","DESCRIPTION","url","URL","layerList","PARAMS","attribution","geometryType","minzoom","MINZOOM","maxzoom","MAXZOOM","localTable","metadataUrl","METADATA_URL","minX","maxX","minY","maxY","opacity","OPTIONS","queryTemplate","hoverTemplate","queryable","visible","collapsed","idCol","shapeCol","allowEdit","allowExport","cacheTiles","labelDefault","labelEnabled","name","getReducer","initialData","_shouldInitialize","state","type","payload","Object","assign","doCm2Initialize","dispatch","store","cm3Layers","sortedLayers","forEach","idMap","selectIdMap","parentUid","selectTreeViewRootId","doAddLayer","reactCm2ShouldInitialize","cm2","actionCreator"],"mappings":"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","sourcesContent":["import orderBy from \"lodash/orderBy\";\nimport layerConfig from \"./config.json\";\nimport scaleToZoomLevel from \"../cm2/scale-to-zoom-level\";\n\nfunction mapCm2ToCm3(layers) {\n  return layers.map((lyr) => {\n    return {\n      id: lyr.NAME,\n      parentId: lyr.PARENT === \"root\" ? null : lyr.PARENT,\n      layerOrder: lyr.LAYERORDER,\n      serviceType: lyr.LAYERTYPE === \"F\" ? \"Folder\" : lyr.LAYERTYPE,\n      tiled: 0,\n      displayName: lyr.FULLNAME,\n      description: lyr.DESCRIPTION,\n      url: lyr.URL,\n      layerList: lyr.PARAMS\n        ? lyr.PARAMS.layers\n          ? lyr.PARAMS.layers\n          : null\n        : null,\n      attribution: null,\n      geometryType: null,\n      minzoom: scaleToZoomLevel(lyr.MINZOOM, 0),\n      maxzoom: scaleToZoomLevel(lyr.MAXZOOM, 20),\n      localTable: \"NOAA.NATIONAL_FCST_VW_MIN\",\n      metadataUrl: lyr.METADATA_URL,\n      minX: -180,\n      maxX: 180,\n      minY: -89,\n      maxY: 89,\n      opacity: lyr.OPTIONS\n        ? lyr.OPTIONS.opacity\n          ? lyr.OPTIONS.opacity\n          : 1\n        : 1,\n      queryTemplate: null,\n      hoverTemplate: null,\n      queryable: 1,\n      visible: 0,\n      collapsed: 1,\n      idCol: \"objectid\",\n      shapeCol: \"SHAPE\",\n      allowEdit: 0,\n      allowExport: 1,\n      cacheTiles: 0,\n      labelDefault: 0,\n      labelEnabled: 0,\n    };\n  });\n}\n\nexport default {\n  name: \"cm2\",\n\n  getReducer: () => {\n    const initialData = {\n      _shouldInitialize: false,\n    };\n\n    return (state = initialData, { type, payload }) => {\n      switch (type) {\n        case \"CM2_INITIALIZE_START\":\n        case \"CM2_INITIALIZE_FINISHED\":\n          return Object.assign({}, state, payload);\n        case \"MAP_INITIALIZED\":\n          return Object.assign({}, state, {\n            _shouldInitialize: true,\n          });\n        default:\n          return state;\n      }\n    };\n  },\n\n  doCm2Initialize: () => ({ dispatch, store }) => {\n    dispatch({\n      type: \"CM2_INITIALIZE_START\",\n      payload: { _shouldInitialize: false },\n    });\n    // maybe turn this on at some point\n    // const params = store.selectWindowLocationParams();\n    // const turnOn = !params.layers ? [] : params.layers.split(\",\").map(Number);\n\n    const cm3Layers = mapCm2ToCm3(layerConfig);\n\n    const sortedLayers = orderBy(\n      cm3Layers,\n      [\"parentId\", \"layerOrder\"],\n      [\"desc\", \"asc\"]\n    );\n    sortedLayers.forEach((lyr) => {\n      if (lyr.parentId) {\n        const idMap = store.selectIdMap();\n        lyr.parentUid = idMap[lyr.parentId];\n      } else {\n        lyr.parentUid = store.selectTreeViewRootId;\n      }\n      // if (lyr.teamDatasetId && turnOn.indexOf(lyr.teamDatasetId) !== -1) {\n      //   lyr.visible = true;\n      // }\n      store.doAddLayer(lyr);\n    });\n    dispatch({\n      type: \"CM2_INITIALIZE_FINISHED\",\n    });\n  },\n\n  reactCm2ShouldInitialize: (state) => {\n    if (state.cm2._shouldInitialize)\n      return { actionCreator: \"doCm2Initialize\" };\n  },\n};\n"]},"metadata":{},"sourceType":"module"}