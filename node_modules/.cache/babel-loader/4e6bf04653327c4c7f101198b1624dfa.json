{"ast":null,"code":"import VectorLayer from 'ol/layer/Vector';\nimport VectorSource from 'ol/source/Vector';\nimport Style from 'ol/style/Style';\nimport Fill from 'ol/style/Fill';\nimport Stroke from 'ol/style/Stroke';\nimport Circle from 'ol/style/Circle';\nimport GeoJSON from 'ol/format/GeoJSON';\nconst geoJSON = new GeoJSON();\nexport default {\n  name: 'collab',\n  getReducer: () => {\n    const initialData = {\n      layer: null,\n      lastMessage: null,\n      shouldInitalize: false,\n      shouldFetch: false,\n      shouldHandleMsg: false,\n      ready: false\n    };\n    return (state = initialData, {\n      type,\n      payload\n    }) => {\n      switch (type) {\n        case 'COLLAB_INITIALIZE_STARTED':\n        case 'COLLAB_INITIALIZE_FINISHED':\n        case 'COLLAB_FETCH_STARTED':\n          return Object.assign({}, state, payload);\n\n        case 'WEBSOCKET_MESSAGE':\n          return Object.assign({}, state, {\n            lastMessage: payload.e,\n            shouldHandleMsg: true\n          });\n\n        case \"MAP_INITIALIZED\":\n          return Object.assign({}, state, {\n            shouldInitalize: true\n          });\n\n        default:\n          return state;\n      }\n    };\n  },\n  doCollabInitialize: () => ({\n    dispatch,\n    store\n  }) => {\n    dispatch({\n      type: 'COLLAB_INITIALIZE_STARTED',\n      payload: {\n        shouldInitalize: false\n      }\n    });\n    const map = store.selectMap();\n    const source = new VectorSource();\n    const layer = new VectorLayer({\n      source: source,\n      style: (feature, resolution) => {\n        const properties = feature.getProperties();\n        const style = properties.style || {};\n        return new Style({\n          fill: new Fill({\n            color: style.fillColor || \"rgba( 66,232,244,.5)\"\n          }),\n          stroke: new Stroke({\n            width: style.strokeWidth || 3,\n            color: style.strokeColor || \"rgba( 66,232,244,.5)\"\n          }),\n          image: new Circle({\n            radius: style.circleRadius || 7,\n            fill: new Fill({\n              color: style.circleFill || \"rgba( 66,232,244,.5)\"\n            }),\n            stroke: new Stroke({\n              width: style.circleStrokeWidth || 3,\n              color: style.circleFillColor || \"rgba( 66,232,244,.5)\"\n            })\n          })\n        });\n      }\n    });\n    map.addLayer(layer);\n    dispatch({\n      type: 'COLLAB_INITIALIZE_FINISHED',\n      payload: {\n        layer: layer,\n        shouldFetch: true,\n        ready: true\n      }\n    });\n  },\n  doCollabFetch: () => ({\n    dispatch,\n    store,\n    apiGet\n  }) => {\n    dispatch({\n      type: 'COLLAB_FETCH_STARTED',\n      payload: {\n        shouldFetch: false\n      }\n    });\n    apiGet('/data', (err, response, body) => {\n      if (err || response.statusCode !== 200) {\n        console.error('ERROR', response);\n      } else {\n        const layer = store.selectCollabLayer();\n        const source = layer.getSource();\n        const features = geoJSON.readFeatures(body);\n        source.addFeatures(features);\n        dispatch({\n          type: 'DRAW_DATA_UPDATE_STATS',\n          payload: {\n            shouldCalculateStats: true\n          }\n        });\n      }\n    });\n    dispatch({\n      type: 'COLLAB_FETCH_FINISHED',\n      payload: {}\n    });\n  },\n  doCollabHandleMsg: () => ({\n    dispatch,\n    store\n  }) => {\n    dispatch({\n      type: 'COLLAB_HANDLE_MSG_STARTED',\n      payload: {\n        shouldHandleMsg: false\n      }\n    });\n    const ready = store.selectCollabReady();\n\n    if (ready) {\n      const myEdipi = store.selectAuthEdipi();\n      const lastMessage = store.selectCollabLastMessage();\n      const data = JSON.parse(lastMessage.data);\n\n      if (myEdipi !== data.edipi) {\n        switch (data.action) {\n          case 'insert':\n            store.doCollabFetchFeatureById(data.id, data.edipi);\n            break;\n\n          case 'delete':\n            store.doCollabDeleteFeatureById(data.id);\n            break;\n\n          case 'update':\n            store.doCollabFetchFeatureById(data.id, data.edipi);\n            break;\n\n          default:\n        }\n      }\n    }\n  },\n  doCollabFetchFeatureById: (id, edipi) => ({\n    dispatch,\n    store,\n    apiGet\n  }) => {\n    apiGet(\"/data/\".concat(edipi, \"/\").concat(id), (err, response, body) => {\n      if (err || response.statusCode !== 200) {\n        console.error(response);\n      } else {\n        const layer = store.selectCollabLayer();\n        const source = layer.getSource();\n        const feature = source.getFeatureById(id);\n\n        if (feature) {\n          source.removeFeature(feature);\n        }\n\n        const newFeature = geoJSON.readFeature(body);\n        source.addFeature(newFeature);\n        dispatch({\n          type: 'DRAW_DATA_UPDATE_STATS',\n          payload: {\n            shouldCalculateStats: true\n          }\n        });\n      }\n    });\n  },\n  doCollabDeleteFeatureById: (id, edipi) => ({\n    dispatch,\n    store,\n    apiDelete\n  }) => {\n    const layer = store.selectCollabLayer();\n    const source = layer.getSource();\n    const feature = source.getFeatureById(id);\n\n    if (feature) {\n      source.removeFeature(feature);\n      dispatch({\n        type: 'DRAW_DATA_UPDATE_STATS',\n        payload: {\n          shouldCalculateStats: true\n        }\n      });\n    }\n  },\n  selectCollabLayer: state => {\n    return state.collab.layer;\n  },\n  selectCollabLastMessage: state => {\n    return state.collab.lastMessage;\n  },\n  selectCollabReady: state => {\n    return state.collab.ready;\n  },\n  reactCollabShouldInitialize: state => {\n    if (state.collab.shouldInitalize) return {\n      actionCreator: 'doCollabInitialize'\n    };\n  },\n  reactCollabShouldFetch: state => {\n    if (state.collab.shouldFetch) return {\n      actionCreator: 'doCollabFetch'\n    };\n  },\n  reactorCollabShouldHandleMsg: state => {\n    if (state.collab.shouldHandleMsg) return {\n      actionCreator: 'doCollabHandleMsg'\n    };\n  }\n};","map":{"version":3,"sources":["C:\\Examples\\nsifrontend\\src\\app-bundles\\collab-bundle.js"],"names":["VectorLayer","VectorSource","Style","Fill","Stroke","Circle","GeoJSON","geoJSON","name","getReducer","initialData","layer","lastMessage","shouldInitalize","shouldFetch","shouldHandleMsg","ready","state","type","payload","Object","assign","e","doCollabInitialize","dispatch","store","map","selectMap","source","style","feature","resolution","properties","getProperties","fill","color","fillColor","stroke","width","strokeWidth","strokeColor","image","radius","circleRadius","circleFill","circleStrokeWidth","circleFillColor","addLayer","doCollabFetch","apiGet","err","response","body","statusCode","console","error","selectCollabLayer","getSource","features","readFeatures","addFeatures","shouldCalculateStats","doCollabHandleMsg","selectCollabReady","myEdipi","selectAuthEdipi","selectCollabLastMessage","data","JSON","parse","edipi","action","doCollabFetchFeatureById","id","doCollabDeleteFeatureById","getFeatureById","removeFeature","newFeature","readFeature","addFeature","apiDelete","collab","reactCollabShouldInitialize","actionCreator","reactCollabShouldFetch","reactorCollabShouldHandleMsg"],"mappings":"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","sourcesContent":["import VectorLayer from 'ol/layer/Vector';\r\nimport VectorSource from 'ol/source/Vector';\r\nimport Style from 'ol/style/Style';\r\nimport Fill from 'ol/style/Fill';\r\nimport Stroke from 'ol/style/Stroke';\r\nimport Circle from 'ol/style/Circle';\r\nimport GeoJSON from 'ol/format/GeoJSON';\r\nconst geoJSON = new GeoJSON();\r\n\r\nexport default{\r\n    name: 'collab',\r\n    getReducer:()=>{\r\n        const initialData = {\r\n            layer: null,\r\n            lastMessage: null,\r\n            shouldInitalize: false,\r\n            shouldFetch: false,\r\n            shouldHandleMsg: false,\r\n            ready: false\r\n        }\r\n        return (state = initialData, {type, payload})=>{\r\n            switch(type){\r\n                case'COLLAB_INITIALIZE_STARTED':\r\n                case'COLLAB_INITIALIZE_FINISHED':\r\n                case 'COLLAB_FETCH_STARTED':\r\n                    return Object.assign({}, state, payload)\r\n                case 'WEBSOCKET_MESSAGE':\r\n                return Object.assign({}, state, {\r\n                    lastMessage: payload.e,\r\n                    shouldHandleMsg: true\r\n                });\r\n                case \"MAP_INITIALIZED\":\r\n                    return Object.assign({}, state, {\r\n                        shouldInitalize: true\r\n                    });\r\n                default:\r\n                    return state\r\n            }\r\n        }\r\n    },    \r\n    doCollabInitialize: () => ({dispatch, store}) => {\r\n    dispatch({type: 'COLLAB_INITIALIZE_STARTED', payload: {shouldInitalize: false}})\r\n    const map = store.selectMap();\r\n    const source = new VectorSource();\r\n    const layer = new VectorLayer({\r\n        source: source,\r\n        style: (feature, resolution )=>{\r\n            const properties = feature.getProperties();\r\n            const style = properties.style || {};\r\n            return new Style({\r\n            fill: new Fill({\r\n                color: style.fillColor || `rgba( 66,232,244,.5)`\r\n            }),\r\n            stroke: new Stroke({\r\n                width: style.strokeWidth || 3,\r\n                color: style.strokeColor || `rgba( 66,232,244,.5)`\r\n            }),\r\n            image: new Circle({\r\n                radius: style.circleRadius || 7,\r\n                fill: new Fill({\r\n                    color: style.circleFill || `rgba( 66,232,244,.5)`\r\n                }),\r\n                stroke: new Stroke({\r\n                    width: style.circleStrokeWidth || 3,\r\n                    color: style.circleFillColor || `rgba( 66,232,244,.5)`\r\n                })\r\n            })\r\n        })\r\n    }\r\n    })\r\n    map.addLayer(layer);\r\n    dispatch({\r\n        type: 'COLLAB_INITIALIZE_FINISHED',\r\n        payload:{\r\n            layer: layer,\r\n            shouldFetch: true,\r\n            ready: true\r\n        }\r\n    })\r\n},\r\ndoCollabFetch: () => ({dispatch, store, apiGet}) => {\r\n    dispatch({type: 'COLLAB_FETCH_STARTED', payload: {shouldFetch: false}})\r\n\r\n    \r\n    apiGet('/data',(err,response,body)=>{\r\n        if(err || response.statusCode !== 200){\r\n            console.error('ERROR', response);\r\n        }else{\r\n            const layer = store.selectCollabLayer();\r\n            const source = layer.getSource();\r\n            const features = geoJSON.readFeatures(body);\r\n            source.addFeatures(features);\r\n            dispatch({type: 'DRAW_DATA_UPDATE_STATS', payload: {\r\n                shouldCalculateStats: true\r\n            }})\r\n        }\r\n    })\r\n    dispatch({type: 'COLLAB_FETCH_FINISHED', payload: {}})\r\n},\r\ndoCollabHandleMsg: () => ({dispatch, store}) => {\r\n    dispatch({type: 'COLLAB_HANDLE_MSG_STARTED', payload:{shouldHandleMsg: false}})\r\n    const ready = store.selectCollabReady();\r\n    if(ready){\r\n        const myEdipi = store.selectAuthEdipi();\r\n        const lastMessage = store.selectCollabLastMessage();\r\n        const data = JSON.parse(lastMessage.data)\r\n        if(myEdipi !== data.edipi){\r\n            switch(data.action){\r\n                case 'insert':\r\n                    store.doCollabFetchFeatureById(data.id, data.edipi)\r\n                    break;\r\n                case 'delete':\r\n                    store.doCollabDeleteFeatureById(data.id)\r\n                    break;\r\n                case 'update':\r\n                    store.doCollabFetchFeatureById(data.id, data.edipi)\r\n                    break;\r\n                default:\r\n            }\r\n        }        \r\n    }\r\n\r\n\r\n},\r\ndoCollabFetchFeatureById: (id, edipi) => ({dispatch, store, apiGet}) =>{\r\n    apiGet(`/data/${edipi}/${id}`, (err, response, body) =>{\r\n        if(err || response.statusCode !== 200){\r\n            console.error(response)\r\n        }else{\r\n            const layer = store.selectCollabLayer();\r\n            const source = layer.getSource();\r\n            const feature = source.getFeatureById(id)\r\n            if(feature){\r\n                source.removeFeature(feature);\r\n            }\r\n            const newFeature = geoJSON.readFeature(body);\r\n            source.addFeature(newFeature);\r\n            dispatch({type: 'DRAW_DATA_UPDATE_STATS', payload: {\r\n                shouldCalculateStats: true\r\n            }})\r\n        }\r\n    })\r\n},\r\ndoCollabDeleteFeatureById: (id, edipi) => ({dispatch, store, apiDelete}) =>{\r\n            const layer = store.selectCollabLayer();\r\n            const source = layer.getSource();\r\n            const feature = source.getFeatureById(id)\r\n            if(feature){\r\n                source.removeFeature(feature);\r\n                dispatch({type: 'DRAW_DATA_UPDATE_STATS', payload: {\r\n                    shouldCalculateStats: true\r\n                }})\r\n            }\r\n},\r\nselectCollabLayer: (state) => {\r\n    return state.collab.layer;\r\n},\r\nselectCollabLastMessage: (state) =>{\r\n    return state.collab.lastMessage;\r\n},\r\nselectCollabReady: (state) =>{\r\n    return state.collab.ready;\r\n},\r\nreactCollabShouldInitialize: (state) => {\r\n    if(state.collab.shouldInitalize) return { actionCreator: 'doCollabInitialize'}\r\n},\r\nreactCollabShouldFetch: (state) => {\r\n    if(state.collab.shouldFetch) return { actionCreator: 'doCollabFetch'}\r\n},\r\nreactorCollabShouldHandleMsg: (state) => {\r\n    if(state.collab.shouldHandleMsg) return {actionCreator: 'doCollabHandleMsg'}\r\n}\r\n}"]},"metadata":{},"sourceType":"module"}