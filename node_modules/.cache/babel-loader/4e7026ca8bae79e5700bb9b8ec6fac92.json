{"ast":null,"code":"function noop() {}\n\nexport default function (url, opts) {\n  opts = opts || {};\n  var ws,\n      num = 0,\n      timer = 1,\n      $ = {};\n  var max = opts.maxAttempts || Infinity;\n\n  $.open = function () {\n    ws = new WebSocket(url, opts.protocols || []);\n    ws.onmessage = opts.onmessage || noop;\n\n    ws.onopen = function (e) {\n      (opts.onopen || noop)(e);\n      num = 0;\n    };\n\n    ws.onclose = function (e) {\n      e.code === 1e3 || e.code === 1001 || e.code === 1005 || $.reconnect(e);\n      (opts.onclose || noop)(e);\n    };\n\n    ws.onerror = function (e) {\n      e && e.code === 'ECONNREFUSED' ? $.reconnect(e) : (opts.onerror || noop)(e);\n    };\n  };\n\n  $.reconnect = function (e) {\n    if (timer && num++ < max) {\n      timer = setTimeout(function () {\n        (opts.onreconnect || noop)(e);\n        $.open();\n      }, opts.timeout || 1e3);\n    } else {\n      (opts.onmaximum || noop)(e);\n    }\n  };\n\n  $.json = function (x) {\n    ws.send(JSON.stringify(x));\n  };\n\n  $.send = function (x) {\n    ws.send(x);\n  };\n\n  $.close = function (x, y) {\n    timer = clearTimeout(timer);\n    ws.close(x || 1e3, y);\n  };\n\n  $.open(); // init\n\n  return $;\n}","map":null,"metadata":{},"sourceType":"module"}